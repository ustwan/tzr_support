â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ“¡ FEEDBACK BOT - ĞšĞ ĞĞ¢ĞšĞĞ¯ Ğ¡Ğ’ĞĞ”ĞšĞ Ğ”Ğ›Ğ¯ DJANGO AI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¤– Ğ‘ĞĞ¢ ĞŸĞĞ”ĞšĞ›Ğ®Ğ§ĞĞ•Ğ¢Ğ¡Ğ¯ Ğš Ğ¡ĞĞ™Ğ¢Ğ£ Ğ§Ğ•Ğ Ğ•Ğ— WEBSOCKET (Ğ˜Ğ¡Ğ¥ĞĞ”Ğ¯Ğ©Ğ•Ğ•)

wss://tzreloaded.ru/ws/feedback-bot?token=<JWT>

ĞĞ•Ğ¢ ĞĞ¢ĞšĞ Ğ«Ğ¢Ğ«Ğ¥ ĞŸĞĞ Ğ¢ĞĞ’!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ĞŸĞ ĞĞ¢ĞĞšĞĞ›:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ğ¡Ğ°Ğ¹Ñ‚ â†’ Ğ‘Ğ¾Ñ‚ (Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ):
{
  type: "new_feedback",
  id: "uuid",
  data: {
    feedback_id: 123,
    telegram_id: 999,
    telegram_username: "user",
    telegram_first_name: "Ğ˜Ğ¼Ñ",
    nickname: "PlayerNick",
    category: "bug",
    message: "Ğ¢ĞµĞºÑÑ‚",
    created_at: "2025-10-17T12:00:00",
    source: "website"
  },
  ts: timestamp,
  nonce: "uuid",
  sig: "hmac-sha256"
}

Ğ‘Ğ¾Ñ‚ â†’ Ğ¡Ğ°Ğ¹Ñ‚ (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚):
{
  type: "feedback_result",
  id: "uuid",
  ok: true,
  result: {
    ticket_id: "ticket_site_123",
    message_id: 456,
    sent_at: "2025-10-17T12:00:01"
  },
  error: null,
  ts, nonce, sig
}

HMAC: sig = HMAC(secret, "{ts}.{nonce}.{compact_json}")
      compact_json = JSON.dumps(sort_keys=True, separators=(',',':'))

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ğ”Ğ›Ğ¯ DJANGO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹ consumer: portal/consumers.py
   
   class FeedbackBotConsumer(AsyncWebsocketConsumer):
       async def connect(self):
           # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ JWT Ñ‚Ğ¾ĞºĞµĞ½
           # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ: self.bot_connected = True
       
       async def receive(self, text_data):
           # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¾Ñ‚ Ğ±Ğ¾Ñ‚Ğ°
           # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸ feedback.telegram_sent = True

2. Ğ Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³: portal/routing.py
   
   websocket_urlpatterns = [
       path('ws/feedback-bot', FeedbackBotConsumer.as_asgi()),
   ]

3. ĞŸÑ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ feedback:
   
   feedback = Feedback.objects.create(...)
   
   # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‡ĞµÑ€ĞµĞ· WebSocket
   await channel_layer.send('feedback-bot', {
       'type': 'new_feedback',
       'id': str(uuid.uuid4()),
       'data': {...},
       'ts': int(time.time()),
       'nonce': str(uuid.uuid4()),
       'sig': compute_hmac(...)
   })

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â±ï¸ Ğ’Ğ Ğ•ĞœĞ¯: ~30 Ğ¼Ğ¸Ğ½ÑƒÑ‚

ğŸ“¦ ĞšĞĞ” Ğ‘ĞĞ¢Ğ: https://github.com/ustwan/tzr_support

Ğ›ĞĞ“Ğ˜ĞšĞ HMAC: Ğ¢Ğ° Ğ¶Ğµ Ñ‡Ñ‚Ğ¾ Ğ² Site Agent (portal/site_agent/hmac_utils.py)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

